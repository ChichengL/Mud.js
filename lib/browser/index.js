!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Mud=t()}(this,(function(){"use strict";class e{constructor(){this.viewers=[]}addViewer(e){this.viewers.push(e)}publish(){this.viewers.forEach((e=>{e.update()}))}}class t{constructor(e){Object.keys(e).forEach((t=>{this.hijack(e,t)}))}hijack(t,i){const o=new e;let s=t[i];if(null!=s)if("object"==typeof s)Object.keys(s).forEach((e=>{this.hijack(s,e)}));else{const n=this;Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>(e.viewer&&o.addViewer(e.viewer),s),set(e){s!==e&&(s=e,n.hijack(e),o.publish())}})}}}class i{constructor(t,i,o,s){this.mud=t,this.dataKey=i,this.updateHandler=o,this.node=s,e.viewer=this,this.oldValue=t.data[i],e.viewer=null}update(){const e=this.mud.data[this.dataKey];this.oldValue!==e&&(this.oldValue=e,this.node?this.updateHandler(e,this.node):this.updateHandler(e))}}const o=(e,t,o,s)=>{const n=/\{(.+?)\}/,a=o.match(n);if(a){const c=a[1];if("undefined"===e.data[c])return;const d=s?e=>{t.value=e}:e=>{t.textContent=e};new i(e,c,d),s&&t.addEventListener("input",(()=>{e.data[c]=t.value}));d(o.replace(n,e.data[c]))}},s=(e,t,o)=>{const{name:s,value:n}=o;if("m-if"===s){const o=e.data[n];var a=null,c=(e,t)=>{console.log(e),e?(console.log("可以看见"),a&&a.parentNode.replaceChild(t,a)):(console.log("创造注释节点"),a=(e=>{const t=document.createComment("m-if");return e.parentNode.replaceChild(t,e),t})(t))};new i(e,n,c,t),c(o,t)}};class n{constructor(e){this.mud=e,this.el=e.el,this.compile(this.el)}compile(e){const t=e.childNodes;Array.from(t).forEach((e=>{1===e.nodeType?this.compileForElement(e):3===e.nodeType&&this.compileForText(e),e.childNodes.length&&this.compile(e)}))}compileForElement(e){Array.from(e.attributes).forEach((t=>{const{name:i,value:n}=t;o(this.mud,e,n,!0),((e,t,i)=>{const{name:o,value:s}=i;if("map"===o){const[i,o]=s.split(":"),n=e.data[o],a=new RegExp(`{${i}}`),c=`${t.innerHTML}`,d=n?.reduce(((e,t)=>{let i=c;return c.match(a)&&(i=c.replace(a,t)),e+i}),"");t.innerHTML=d}})(this.mud,e,t),s(this.mud,e,t)}))}compileForText(e){o(this.mud,e,e.textContent)}}return class{constructor(e){this.el=document.querySelector(e.el),this.data=e.data,new t(this.data),new n(this)}}})),"undefined"!=typeof window&&(window.MUD_VERSION="1.1.2");
