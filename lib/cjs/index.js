"use strict";class e{constructor(){this.viewers=[]}addViewer(e){this.viewers.push(e)}publish(){this.viewers.forEach((e=>{e.update()}))}}class t{constructor(e){Object.keys(e).forEach((t=>{this.hijack(e,t)}))}hijack(t,s){const i=new e;let o=t[s];if(null!=o)if("object"==typeof o)Object.keys(o).forEach((e=>{this.hijack(o,e)}));else{const a=this;Object.defineProperty(t,s,{enumerable:!0,configurable:!0,get:()=>(e.viewer&&i.addViewer(e.viewer),o),set(e){o!==e&&(o=e,a.hijack(e),i.publish())}})}}}class s{constructor(t,s,i,o){this.mud=t,this.dataKey=s,this.updateHandler=i,this.node=o,e.viewer=this,this.oldValue=t.data[s],e.viewer=null}update(){const e=this.mud.data[this.dataKey];this.oldValue!==e&&(this.oldValue=e,this.node?this.updateHandler(e,this.node):this.updateHandler(e))}}const i=(e,t,i,o)=>{const a=/\{(.+?)\}/,n=i.match(a);if(n){const c=n[1];if("undefined"===e.data[c])return;const l=o?e=>{t.value=e}:e=>{t.textContent=e};new s(e,c,l),o&&t.addEventListener("input",(()=>{e.data[c]=t.value}));l(i.replace(a,e.data[c]))}},o=(e,t,i)=>{const{name:o,value:a}=i;if("m-if"===o){const i=e.data[a];var n=null,c=(e,t)=>{console.log(e),e?(console.log("可以看见"),n&&n.parentNode.replaceChild(t,n)):(console.log("创造注释节点"),n=(e=>{const t=document.createComment("m-if");return e.parentNode.replaceChild(t,e),t})(t))};new s(e,a,c,t),c(i,t)}};class a{constructor(e){this.mud=e,this.el=e.el,this.compile(this.el)}compile(e){const t=e.childNodes;Array.from(t).forEach((e=>{1===e.nodeType?this.compileForElement(e):3===e.nodeType&&this.compileForText(e),e.childNodes.length&&this.compile(e)}))}compileForElement(e){Array.from(e.attributes).forEach((t=>{const{name:s,value:a}=t;i(this.mud,e,a,!0),((e,t,s)=>{const{name:i,value:o}=s;if("map"===i){const[s,i]=o.split(":"),a=e.data[i],n=new RegExp(`{${s}}`),c=`${t.innerHTML}`,l=a?.reduce(((e,t)=>{let s=c;return c.match(n)&&(s=c.replace(n,t)),e+s}),"");t.innerHTML=l}})(this.mud,e,t),o(this.mud,e,t)}))}compileForText(e){i(this.mud,e,e.textContent)}}module.exports=class{constructor(e){this.el=document.querySelector(e.el),this.data=e.data,new t(this.data),new a(this)}},"undefined"!=typeof window&&(window.MUD_VERSION="1.1.2");
