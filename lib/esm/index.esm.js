class e{constructor(){this.viewers=[]}addViewer(e){this.viewers.push(e)}publish(){this.viewers.forEach((e=>{e.update()}))}}class t{static obj2Proxy=new WeakMap;static proxy2Obj=new WeakMap;constructor(e){Object.keys(e).forEach((t=>{this.hijack(e,t)}))}hijack(t,s){const i=new e;let a=t[s];if(a&&"object"==typeof a){const s=new Proxy(a,{get:(t,s,a)=>(e.viewer&&i.addViewer(e.viewer),Reflect.get(t,s,a)),set(e,t,s){if(a===s)return;a=s,that.hijack(s);const o=Reflect.set(e,t,a,receiver);return i.publish(),o}});obj2Proxy.set(t,s),proxy2Obj.set(),console.log("proxy",t,s),t=s,Object.keys(a).forEach((e=>{this.hijack(a,e)}))}}}class s{constructor(t,s,i){this.mud=t,this.dataKey=s,this.updateHandler=i,e.viewer=this,this.oldValue=t.data[s],e.viewer=null}update(){const e=this.mud.data[this.dataKey];this.oldValue!==e&&this.updateHandler(e)}}const i=(e,t,i,a)=>{const o=/\{(.+?)\}/,r=i.match(o);if(r){const c=r[1];if("undefined"===e.data[c])return;const n=a?e=>{t.value=e}:e=>{t.textContent=e};new s(e,c,n),a&&t.addEventListener("input",(()=>{e.data[c]=t.value}));n(i.replace(o,e.data[c]))}};class a{constructor(e){this.mud=e,this.el=e.el,this.compile(this.el)}compile(e){const t=e.childNodes;Array.from(t).forEach((e=>{1===e.nodeType?this.compileForElement(e):3===e.nodeType&&this.compileForText(e),e.childNodes.length&&this.compile(e)}))}compileForElement(e){Array.from(e.attributes).forEach((t=>{const{name:s,value:a}=t;i(this.mud,e,a,!0),((e,t,s)=>{const{name:i,value:a}=s;if("for"===i){const[s,i]=a.split(":"),o=e.data[i],r=new RegExp(`{${s}}`),c=`${t.innerHTML}`,n=o?.reduce(((e,t)=>{let s=c;return c.match(r)&&(s=c.replace(r,t)),e+s}),"");t.innerHTML=n}})(this.mud,e,t)}))}compileForText(e){i(this.mud,e,e.textContent,!1)}}export default class{constructor(e){this.el=document.querySelector(e.el),this.data=e.data,new t(this.data),new a(this)}}"undefined"!=typeof window&&(window.MUD_VERSION="1.1.3");
