class e{constructor(){this.viewers=[]}addViewer(e){this.viewers.push(e)}publish(){this.viewers.forEach((e=>{e.update()}))}}class t{constructor(e){Object.keys(e).forEach((t=>{this.hijack(e,t)}))}hijack(t,i){const s=new e;let a=t[i];if(a)if("object"==typeof a)Object.keys(a).forEach((e=>{this.hijack(a,e)}));else{const o=this;Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>(e.viewer&&s.addViewer(e.viewer),a),set(e){a!==e&&(a=e,o.hijack(e),s.publish())}})}}}class i{constructor(t,i,s){this.mud=t,this.dataKey=i,this.updateHandler=s,e.viewer=this,this.oldValue=t.data[i],e.viewer=null}update(){const e=this.mud.data[this.dataKey];this.oldValue!==e&&this.updateHandler(e)}}const s=(e,t,s,a)=>{const o=/\{(.+?)\}/,c=s.match(o);if(c){const n=c[1];if("undefined"===e.data[n])return;const r=a?e=>{t.value=e}:e=>{t.textContent=e};new i(e,n,r),a&&t.addEventListener("input",(()=>{e.data[n]=t.value}));r(s.replace(o,e.data[n]))}};class a{constructor(e){this.mud=e,this.el=e.el,this.compile(this.el)}compile(e){const t=e.childNodes;Array.from(t).forEach((e=>{1===e.nodeType?this.compileForElement(e):3===e.nodeType&&this.compileForText(e),e.childNodes.length&&this.compile(e)}))}compileForElement(e){Array.from(e.attributes).forEach((t=>{const{name:i,value:a}=t;s(this.mud,e,a,!0),((e,t,i)=>{const{name:s,value:a}=i;if("map"===s){const[i,s]=a.split(":"),o=e.data[s],c=new RegExp(`{${i}}`),n=`${t.innerHTML}`,r=o?.reduce(((e,t)=>{let i=n;return n.match(c)&&(i=n.replace(c,t)),e+i}),"");t.innerHTML=r}})(this.mud,e,t)}))}compileForText(e){s(this.mud,e,e.textContent)}}export default class{constructor(e){this.el=document.querySelector(e.el),this.data=e.data,new t(this.data),new a(this)}}"undefined"!=typeof window&&(window.MUD_VERSION="1.1.1");
