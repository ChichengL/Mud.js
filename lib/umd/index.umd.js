!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Mud=t()}(this,(function(){"use strict";class e{constructor(){this.viewers=[]}addViewer(e){this.viewers.push(e)}publish(){this.viewers.forEach((e=>{e.update()}))}}const t=e=>null!==e&&"object"==typeof e;class s{constructor(t){this.publisher=new e,this.obj2Proxy=new WeakMap,t.data=this.hijack(t.data)}hijack(s){const i=this;return t(s)?new Proxy(s,{get(s,n,o){const r=Reflect.get(s,n,o);if(e.viewer&&i.publisher.addViewer(e.viewer),t(r)){const e=i.obj2Proxy.get(r);if(e)return e;{const e=i.hijack(r);i.obj2Proxy.set(r,e)}}return r},set(e,t,s,n){const o=Reflect.set(e,t,s,n);return i.publisher.publish(),o},deleteProperty(e,t){const s=Reflect.deleteProperty(e,t);return i.publisher.publish(),s}}):s}}class i{constructor(t,s,i,n){this.mud=t,this.dataKey=s,this.updateHandler=i,this.node=n,e.viewer=this,this.oldValue=t.data[s],e.viewer=null}update(){const e=this.mud.data[this.dataKey];this.oldValue!==e&&(this.oldValue=e,this.node?this.updateHandler(e,this.node):this.updateHandler(e))}}const n=(e,t,s,n)=>{const o=/\{(.+?)\}/,r=s.match(o);if(r){const a=r[1];if("undefined"===e.data[a])return;const d=n?e=>{t.value=e}:e=>{t.textContent=e};new i(e,a,d),n&&t.addEventListener("input",(()=>{e.data[a]=t.value}));d(s.replace(o,e.data[a]))}},o=(e,t,s)=>{const{name:n,value:o}=s;if("m-if"===n){const s=e.data[o];let n=null;const r=(e,t)=>{e?n&&n.parentNode.replaceChild(t,n):n=(e=>{const t=document.createComment("m-if");return e.parentNode.replaceChild(t,e),t})(t)};new i(e,o,r,t),r(s,t)}};class r{constructor(e){this.mud=e,this.el=e.el,this.compile(this.el)}compile(e){const t=e.childNodes;Array.from(t).forEach((e=>{1===e.nodeType?this.compileForElement(e):3===e.nodeType&&this.compileForText(e),e.childNodes.length&&this.compile(e)}))}compileForElement(e){Array.from(e.attributes).forEach((t=>{const{name:s,value:i}=t;n(this.mud,e,i,!0),((e,t,s)=>{const{name:i,value:n}=s;if("for"===i){const[s,i]=n.split(":"),o=e.data[i],r=new RegExp(`{${s}}`),a=`${t.innerHTML}`,d=o?.reduce(((e,t)=>{let s=a;return a.match(r)&&(s=a.replace(r,t)),e+s}),"");t.innerHTML=d}})(this.mud,e,t),o(this.mud,e,t)}))}compileForText(e){n(this.mud,e,e.textContent,!1)}}return class{constructor(e){this.el=document.querySelector(e.el),this.data=e.data,new s(this),new r(this)}}})),"undefined"!=typeof window&&(window.MUD_VERSION="1.1.3");
